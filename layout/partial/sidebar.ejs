<script src="<%= url_for('/js/sidebar.js') %>"></script>

<div class="sidebar-section" x-data="sidebarSection('about')">
  <h3 @click="toggle">
    <span>About</span>
    <span x-text="open ? '-' : '+'"></span>
  </h3>
  <div id="sb-about" x-show="open" x-collapse>
    <p><%= config.description || 'An undescript website.' %></p>
  </div>
  <script>
    (function() {
      var stored = sessionStorage.getItem('flux-sidebar-about');
      if (stored === 'false')
        document.getElementById('sb-about').style.display = 'none';
    })();
  </script>
</div>

<% if (has_social_buttons()) { %>
<div class="sidebar-section social-buttons">
  <%- social_buttons() %>
</div>
<% } %>

<div class="sidebar-section" x-data="sidebarSection('posts')">
  <h3 @click="toggle">
    <span>Recent Posts</span>
    <span x-text="open ? '-' : '+'"></span>
  </h3>
  <div id="sb-posts" x-show="open" x-collapse>
    <ul>
      <% site.posts.sort('date', -1).limit(5).forEach(function(post) { %>
      <li>
        <a href="<%= url_for(post.path) %>">
          <% if (post.encrypted) { %>
          <%- partial('partial/lock') %>
          <% } %>
          <span><%= post.title %></span>
        </a>
      </li>
      <% }) %>
    </ul>
  </div>
  <script>
    (function() {
      var stored = sessionStorage.getItem('flux-sidebar-posts');
      if (stored === 'false')
        document.getElementById('sb-posts').style.display = 'none';
    })();
  </script>
</div>

<%
var sidebarCfg = theme.sidebar || {},
  rpCfg = sidebarCfg.recent_projects || {},
  rpEnabled = rpCfg.enabled !== false,
  rpLimit = rpCfg.limit || 5,
  recentProjects = (rpEnabled && typeof recent_projects === 'function') ? recent_projects(rpLimit) : [];
%>
<% if (rpEnabled && recentProjects.length) { %>
<div class="sidebar-section" x-data="sidebarSection('projects')">
  <h3 @click="toggle">
    <span>Recent Projects</span>
    <span x-text="open ? '-' : '+'"></span>
  </h3>
  <div id="sb-projects" x-show="open" x-collapse>
    <ul>
      <% recentProjects.forEach(function(project) { var href = project.path ? url_for(project.path): (project.project_url || '#'); %>
      <li>
        <a href="<%= href %>">
          <% if (project.password) { %>
          <%- partial('partial/lock') %>
          <% } %>
          <span><%= project.title %></span>
        </a>
      </li>
      <% }); %>
    </ul>
  </div>
  <script>
    (function() {
      var stored = sessionStorage.getItem('flux-sidebar-projects');
      if (stored === 'false')
        document.getElementById('sb-projects').style.display = 'none';
    })();
  </script>
</div>
<% } %>

<% if (theme.sidebar?.palette_selector?.enabled) { %>
<%
  var palettes = palette_list ? palette_list() : [],
    pSelector = (theme.sidebar && theme.sidebar.palette_selector) ? theme.sidebar.palette_selector : {},
    defaultDark = pSelector.default_dark || 'midnight-sun',
    defaultLight = pSelector.default_light || 'paper-and-ink';
%>
<script src="<%= url_for('/js/palette-switcher.js') %>"></script>
<div class="sidebar-section" x-data="sidebarSection('palette')">
  <h3 @click="toggle">
    <span>Palette</span>
    <span x-text="open ? '-' : '+'"></span>
  </h3>
  <div id="sb-palette" class="palette-switcher" x-data="paletteSwitcher(<%= JSON.stringify(palettes) %>, '<%= defaultLight %>', '<%= defaultDark %>')" x-show="open" x-collapse>
    <select id="palette-select" x-model="currentPalette">
      <option value="auto">Auto (System)</option>
      <template x-for="p in palettes" :key="p.key">
        <option :value="p.key" x-text="(p.name || p.key || p.file) + (p.mode === 'light' ? ' (Light)' : '')" :selected="currentPalette === p.key"></option>
      </template>
    </select>
  </div>
  <script>
    (function() {
      var stored = sessionStorage.getItem('flux-sidebar-palette');
      if (stored === 'false')
        document.getElementById('sb-palette').style.display = 'none';
    })();
  </script>
</div>
<% } %>